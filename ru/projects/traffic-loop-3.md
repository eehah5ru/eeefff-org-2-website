---
template: "templates/traffic-loop-layer-3.slim"
scheme: "/images/traffic-loop/sysadmin-scheme-ru.svg"
---

# Инструкция к Трафик Лупу

## Требования к оборудованию:

1. Свободное место более 130Гб
2. Памяти 4Гб и более
4. Желательно не менее 2 ядер

## Краткое описание:

Ландшафт состоит из трех виртуальных машин с ОС Centos7.5  
На каждом маршрутизаторе находятся два сетевых интерфеса с включенным форвардингом   
Зацикливание трафика происходит на IP `192.168.50.10`  
На каждом маршрутизаторе устанавливается TTL на IP `192.168.50.10` в 64  
На каждом интерфейсе отключен `reverse path filter (rp_filter)`  
Примерная производительность на моей машине  5800 пакетов/секунда


## Запуск на Windows:

1. Скачиваем и устанавливаем [vagrant](https://www.vagrantup.com/downloads.html) (если не установлен)
1. Скачиваем и устанавливаем [VirtualBox](https://www.virtualbox.org/wiki/Downloads) (если не установлен)
2. Скачиваем и устанавливаем [putty](https://www.chiark.greenend.org.uk/sgtatham/putty/latest.html)
3. Скачиваем [конфигурационные файлы для тестового ландшафта](https://github.com/eehah5ru/traffic-loop-landscape-routing/archive/master.zip).
3. Разархивируем файлы проекта в любую папку
4. Запускаем `cmd` или `powershell`, заходим в эту папку и далее в папку `traffic-loop-landscape-routing-master`
5. Запускаем стенд: `vagrant up`
6. Смотрим порты которые приписал к каждой машине vagrant: `vagrant ssh-config`
7. Запускаем программу `pageant` (из состава putty)
8. Нажимаем в систем трее не иконку этой программы выбираем _"add key"_
9. Выбираем из разархивированной папки файл `id_rsa.ppk`
10. Открываем putty и набираем адрес `127.0.0.1`; в поле "порт" ставим Port из пункта 7 для сервера *server1*; в имени пользователя, когда запросит, указываем `vagrant`
11. То же для *server2*
12. То же для *server3*
13. Взаимно пингуем IP на разных серверах прилегающие интерфесы других серверов (этот этап нужен, для того чтобы проверить подключение сети, а так же сеть при загрузке в _VirtualBox_ иногда залипает, и не просыпается пока не пройдет трафик в обе стороны). То есть, если IP, например, `192.168.202.1` не пингуется с *server1*, то на *server1* ставим `ping 192.168.202.1`, а на *server3* `ping 192.168.202.2`. Ждем некоторое время (до 10 секунд) и сеть просыпается.
14. Когда все пинги есть на *server2* или *server3* ставим слежение пакетов IP `192.168.50.10`: `sudo tcpdump -xx -XX -ni eth1 host 192.168.50.10`
15. на каком-то из серверов запускаем 1 пакет `ping` на IP `192.168.50.10`:	`ping -c 1 192.168.50.10`
16. Смотрим на `tcpdump` и видим зацикленный пакет: каждая новая строчка --- это одно прохождение через интерфейс eth1
17. Чтобы остановить, нужно выполнить команду на *server1*: `sudo vagrant/routing.sh stop`
18. Чтобы заново включить маршрутизацию: `sudo vagrant/routing.sh start`


## Запуск на Mac OS или Linux:

1. Скачиваем и устанавливаем [vagrant](https://www.vagrantup.com/downloads.html) (если не установлен)
1. Скачиваем и устанавливаем [VirtualBox](https://www.virtualbox.org/wiki/Downloads) (если не установлен)
3. Скачиваем [конфигурационные файлы для тестового ландшафта](https://github.com/eehah5ru/traffic-loop-landscape-routing/archive/master.zip).
3. Разархивируем файлы проекта в любую папку
4. Запускаем Terminal заходим в эту папку и далее в папку `traffic-loop-landscape-routing-master`
5. Запускаем стенд: `vagrant up`
10. Проверяем, что запустился *server1*: `vagrant ssh server1`
11. В новом окне терминала проверяем, что запустился *server2*: `vagrant ssh server2`
12. В еще одном окне терминала проверяем, что запустился *server3*: `vagrant ssh server3`
13. Взаимно пингуем IP на разных серверах прилегающие интерфесы других серверов (этот этап нужен, для того чтобы проверить подключение сети, а так же сеть при загрузке в _VirtualBox_ иногда залипает, и не просыпается пока не пройдет трафик в обе стороны) то есть если IP, например, `192.168.202.1` не пингуется с *server1*, то на *server1* ставим `ping 192.168.202.1`, а на *server3* `ping 192.168.202.2`. Ждем некоторое время (до 10 секунд) и сеть просыпается.
14. Когда все пинги есть на *server2* или *server3* ставим слежение пакетов IP `192.168.50.10`: `sudo tcpdump -xx -XX -ni eth1 host 192.168.50.10`
15. на каком-то из серверов запускаем 1 пакет `ping` на IP `192.168.50.10`:	`ping -c 1 192.168.50.10`
16. Смотрим на `tcpdump` и видим зацикленный пакет: каждая новая строчка --- это одно прохождение через интерфейс eth1
17. Чтобы остановить нужно выполнить команду на *server1*: `sudo ~/vagrant/routing.sh stop`
18. Чтобы заново включить маршрутизацию: `sudo ~/vagrant/routing.sh start`
